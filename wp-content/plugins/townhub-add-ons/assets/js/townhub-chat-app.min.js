!function r(c,i,s){function l(t,e){if(!i[t]){if(!c[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var o=i[t]={exports:{}};c[t][0].call(o.exports,function(e){return l(c[t][1][e]||e)},o,o.exports,r,c,i,s)}return i[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({1:[function(e,t,n){"use strict";var a=r(e("./chatsrc/components/Chats")),o=r(e("./chatsrc/reducers"));function r(e){return e&&e.__esModule?e:{default:e}}var c=ReactRedux.Provider,i=Redux,s=i.createStore,l=i.applyMiddleware,u=s(o.default,l(ReduxThunk.default)),p=document.querySelector("#chat-app");null!=p&&ReactDOM.render(React.createElement(c,{store:u},React.createElement(a.default,null)),p)},{"./chatsrc/components/Chats":4,"./chatsrc/reducers":8}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getContacts=function(){return function(a){var e={action:"townhub_addons_chat_contacts",_nonce:_townhub_add_ons.nonce,for:_townhub_add_ons.curr_user.id,post_id:_townhub_add_ons.post_id};return axios.post(_townhub_add_ons.url,Qs.stringify(e)).then(function(e){var t,n;null!=e.data.debug&&1==e.data.debug&&console.log(e),e.data.success&&a((t=e.data.chat,{type:c.GET_CONTACTS_SUCCESS,chat:t,firstLoaded:n}))}).catch(function(e){console.log(e)})}},n.changeContact=function(n){return function(e){var t;e((t=n,{type:c.CHANGE_CONTACT_SUCCESS,contact:t}))}},n.getReplies=function(t){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return function(a){var e={action:"townhub_addons_chat_replies",_nonce:_townhub_add_ons.nonce,cid:t};return null!=o&&(e.lastRID=o),axios.post(_townhub_add_ons.url,Qs.stringify(e)).then(function(e){var t,n;null!=e.debug&&1==e.debug&&console.log(e),e.data.success&&a((t=e.data.replies,n=o,{type:c.GET_REPLIES_SUCCESS,replies:t,lastRID:n}))}).catch(function(e){console.log(e)})}},n.chatReply=function(t,a,o,r){return function(n){var e=new FormData;return e.append("action","townhub_addons_chat_reply"),e.append("_nonce",_townhub_add_ons.nonce),e.append("cid",t),e.append("user_id",a),e.append("touid",o),e.append("reply_text",r),axios.post(_townhub_add_ons.url,e).then(function(e){var t;null!=e.data.debug&&1==e.data.debug&&console.log(e),e.data.success&&n((t=e.data.reply,{type:c.REPLY_SUCCESS,reply:t}))}).catch(function(e){console.log(e)})}},n.updateFirstLastRID=function(a,o){return function(e){var t,n;e((t=a,n=o,{type:c.UPDATE_FIRST_LAST_RID_SUCCESS,firstRID:t,lastRID:n}))}},n.getMoreTopReplies=function(t,a){return function(n){var e={action:"townhub_addons_chat_replies",_nonce:_townhub_add_ons.nonce,cid:t,firstRID:a};return axios.post(_townhub_add_ons.url,Qs.stringify(e)).then(function(e){var t;null!=e.debug&&1==e.debug&&console.log(e),e.data.success&&n((t=e.data.replies,{type:c.GET_MORE_TOP_REPLIES_SUCCESS,replies:t}))}).catch(function(e){console.log(e)})}},n.resetChatsState=function(){return{type:c.RESET_CHATS_STATE_SUCCESS}};var c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./actionTypes"))},{"./actionTypes":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.GET_CONTACTS_SUCCESS="GET_CONTACTS_SUCCESS",n.GET_REPLIES_SUCCESS="GET_REPLIES_SUCCESS",n.GET_MORE_TOP_REPLIES_SUCCESS="GET_MORE_TOP_REPLIES_SUCCESS",n.CHANGE_CONTACT_SUCCESS="CHANGE_CONTACT_SUCCESS",n.REPLY_SUCCESS="REPLY_SUCCESS",n.UPDATE_FIRST_LAST_RID_SUCCESS="UPDATE_FIRST_LAST_RID_SUCCESS",n.RESET_CHATS_STATE_SUCCESS="RESET_CHATS_STATE_SUCCESS"},{}],4:[function(e,t,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),c=l(e("./inners/Contact")),i=l(e("./inners/Reply")),s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../actions/ChatActions"));function l(e){return e&&e.__esModule?e:{default:e}}var u=ReactRedux.connect,p=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":o(t))&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));t.props.chats;return t.state={isLoggedIn:!1,reply_text:"",showContact:!0,showChatBox:!1,inputFocus:!1},t.scrollAtBottom=!0,t.top_loading=!1,t.timeout=null,t.wrapperRef=null,t.handleChange=t.handleChange.bind(t),t.handleSubmit=t.handleSubmit.bind(t),t.changeContact=t.changeContact.bind(t),t.onRepliesListScroll=t.onRepliesListScroll.bind(t),t.showContact=t.showContact.bind(t),t.toggleChatBox=t.toggleChatBox.bind(t),t.inputFocus=t.inputFocus.bind(t),t.inputBlur=t.inputBlur.bind(t),t.handleClickOutside=t.handleClickOutside.bind(t),t.handleCallChat=t.handleCallChat.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":o(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,React.Component),r(n,[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleClickOutside,!0),window.addEventListener("call_chat",this.handleCallChat,!0);var e=this.props.chats;_townhub_add_ons.curr_user.id&&(this.setState({isLoggedIn:!0}),0==e.firstLoaded&&this.props.getContacts())}},{key:"getRepliesTimeoutFunction",value:function(){var e=this;this.props.getReplies(this.props.chats.active,this.props.chats.lastRID);var t=6e4,n=this.props.chats;5<n.noReplyNum&&(t*=5),10<n.noReplyNum&&(t*=10),20<n.noReplyNum&&(t*=20),this.timeout=setTimeout(function(){e.getRepliesTimeoutFunction()},t)}},{key:"getSnapshotBeforeUpdate",value:function(e,t){if(this.historyChanged=e.chats.replies.length!==this.props.chats.replies.length,this.historyChanged){var n=this.refs.repliesList;if(null==n)return null;var a=n.scrollTop,o=n.scrollHeight-n.clientHeight;if(this.scrollAtBottom=o<=0||o-200<=a,!this.scrollAtBottom&&a<150){var r=n.childNodes.length;this.topReply=0===r?null:n.childNodes[0]}else this.topReply=null}return null}},{key:"componentDidUpdate",value:function(){if(this.historyChanged){this.scrollAtBottom&&this.scrollToBottom(),null!=this.topReply&&ReactDOM.findDOMNode(this.topReply).scrollIntoView();var e=this.props.chats,n=0,a=0;e.replies.map(function(e,t){0===t&&(n=e.crid),a=e.crid}),this.props.updateFirstLastRID(n,a),this.top_loading=!1}}},{key:"componentWillUnmount",value:function(){null!=this.timeout&&clearTimeout(this.timeout),document.removeEventListener("mousedown",this.handleClickOutside,!0),window.removeEventListener("call_chat",this.handleCallChat,!0)}},{key:"handleClickOutside",value:function(e){var t=this;1==this.state.showChatBox&&this.wrapperRef&&0==this.wrapperRef.contains(e.target)&&setTimeout(function(){return t.setState({showChatBox:!1})},100)}},{key:"handleCallChat",value:function(e){console.log(e),this.setState({showChatBox:!0})}},{key:"handleChange",value:function(e){e.preventDefault(),this.setState({reply_text:e.target.value})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.chatReply(this.props.chats.active,_townhub_add_ons.curr_user.id,this.props.chats.touid,this.state.reply_text),this.setState({reply_text:""})}},{key:"showContact",value:function(){null!=this.timeout&&clearTimeout(this.timeout),this.setState({showContact:!0})}},{key:"changeContact",value:function(e,t){t.preventDefault(),e.cid!=this.props.chats.active&&(this.props.changeContact(e),this.props.getReplies(e.cid,!1)),this.setState({showContact:!1}),this.getRepliesTimeoutFunction()}},{key:"onRepliesListScroll",value:function(){if(null!=this.refs.repliesList){var e=this.props.chats,t=this.refs.repliesList.scrollTop;e.firstRemain&&!1===this.top_loading&&0===t&&(this.top_loading=!0,this.props.getMoreTopReplies(e.active,e.firstRID))}}},{key:"scrollToBottom",value:function(){var e=this.refs.repliesList;if(null!=e){var t=e.scrollHeight-e.clientHeight;this.state.inputFocus&&(t+=50),ReactDOM.findDOMNode(e).scrollTop=0<t?t:0}}},{key:"_renderContacts",value:function(n){var a=this;return this.state.showContact&&React.createElement("div",{className:"chat-contacts-wrap"},React.createElement("div",{className:"chat-contacts fl-wrap"},n.contacts.map(function(e,t){return React.createElement(c.default,{key:e.cid,item:e,activeContact:n.active,changeContact:a.changeContact})})))}},{key:"inputFocus",value:function(){var e=this;this.setState({inputFocus:!0}),setTimeout(function(){e.scrollToBottom()},100)}},{key:"inputBlur",value:function(){this.setState({inputFocus:!1})}},{key:"_renderReplies",value:function(e){return 1!=this.state.showContact&&React.createElement("div",{className:"fchat-box-wrap"},React.createElement("div",{className:"chat-box fl-wrap loading-repliess",ref:"repliesList",onScroll:this.onRepliesListScroll},e.replies.map(function(e,t){return React.createElement(i.default,{key:t,item:e})}),this.state.inputFocus&&React.createElement("div",{className:"chat-replies-loading"},React.createElement("span",null),React.createElement("span",null),React.createElement("span",null))),React.createElement("div",{id:"chat-input-wrap",className:"message-input fl-wrap"},React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("textarea",{placeholder:_townhub_add_ons.i18n.chat_type_msg,required:!0,value:this.state.reply_text,onFocus:this.inputFocus,onBlur:this.inputBlur,onChange:this.handleChange}),React.createElement("button",{type:"submit"},React.createElement("i",{className:"fal fa-paper-plane"})))))}},{key:"_renderToggleButton",value:function(){var e="chat-widget-button";return 0==this.state.isLoggedIn?e+=" logreg-modal-open":1==this.state.showChatBox&&(e+=" closechat_btn"),this.state.isLoggedIn?React.createElement("div",{className:e,onClick:this.toggleChatBox},React.createElement("i",{className:"fal fa-comments-alt"}),React.createElement("span",null,_townhub_add_ons.i18n.chat_fr_owner)):React.createElement("div",{className:e},React.createElement("i",{className:"fal fa-comments-alt"}),React.createElement("span",null,_townhub_add_ons.i18n.chat_fr_login))}},{key:"toggleChatBox",value:function(){this.setState({showChatBox:!this.state.showChatBox})}},{key:"render",value:function(){var t=this,e="",n=this.props.chats,a=this.state.showContact;if(null!=n&&null!=n.touid&&Array.isArray(n.contacts)&&n.contacts.length){var o=n.contacts.find(function(e){return e.uid==n.touid});o&&(e=o.display_name)}var r="fchat-wrapper";return 1==this.state.showChatBox&&(r+=" show"),a&&(r+=" fchat-show-contacts"),React.createElement("div",null,this._renderToggleButton(),React.createElement("div",{className:r,ref:function(e){return t.wrapperRef=e}},React.createElement("div",{className:"fchat-inner"},React.createElement("div",{className:"fchat-header"},React.createElement("div",{className:"fchat-title"},a?React.createElement("h3",{className:"fchat-greeting"},_townhub_add_ons.i18n.chat_fr_conver):React.createElement("div",{className:"fchat-chatting"},React.createElement("a",{className:"fchat-back",onClick:this.showContact},React.createElement("i",{className:"fal fa-chevron-left"})),React.createElement("h3",{className:"fchat-chatting-title"},_townhub_add_ons.i18n.chat_fr_cwith,React.createElement("a",{href:"#"}," ",e)))),a&&""!=_townhub_add_ons.chatbox_message&&React.createElement("div",{className:"fchat-desc"},React.createElement("div",{className:"fchat-desc-inner",dangerouslySetInnerHTML:{__html:_townhub_add_ons.chatbox_message}}))),this._renderContacts(n),this._renderReplies(n))))}}]),n}();n.default=u(function(e){return{chats:e.chats}},function(o){return{getContacts:function(){return o(s.getContacts())},changeContact:function(e){return o(s.changeContact(e))},getReplies:function(e,t){return o(s.getReplies(e,t))},chatReply:function(e,t,n,a){return o(s.chatReply(e,t,n,a))},updateFirstLastRID:function(e,t){return o(s.updateFirstLastRID(e,t))},getMoreTopReplies:function(e,t){return o(s.getMoreTopReplies(e,t))},resetChatsState:function(){return o(s.resetChatsState())}}})(p)},{"../actions/ChatActions":2,"./inners/Contact":5,"./inners/Reply":6}],5:[function(e,t,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":o(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":o(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,React.Component),r(t,[{key:"_checkActiveContact",value:function(e){return e==this.props.activeContact?"contact-item active":"contact-item"}},{key:"render",value:function(){var t=this,n=this.props.item;return React.createElement("a",{className:this._checkActiveContact(n.cid),href:"#",onClick:function(e){return t.props.changeContact(n,e)}},React.createElement("div",{className:"contact-avatar"},React.createElement("img",{alt:n.display_name,className:"avatar avatar-150 photo",height:"150",width:"150",src:n.avatar_url})),React.createElement("div",{className:"contact-content"},React.createElement("h4",{className:"display_name"},n.display_name),React.createElement("span",{className:"contact-date"},n.date),null!=n.reply&&-1===n.reply.indexOf("LCARD")?React.createElement("div",{className:"contact-reply-text",dangerouslySetInnerHTML:{__html:n.reply.replace(/\n/g,"<br />")}}):null))}}]),t}();n.default=c},{}],6:[function(e,t,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":o(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":o(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,React.Component),r(t,[{key:"_replyClasses",value:function(e){var t="chat-reply chat-reply-"+e.crid;return e.uid!=e.user_one&&(t+=" chat-reply-reply"),e.uid==e.current_user&&(t+=" your-reply"),t}},{key:"render",value:function(){var e=this.props.item,t=!1,n={},a=e.reply;if(0===a.indexOf("LCARD")){t=!0,a=decodeURIComponent(a.substr(5));try{n=JSON.parse(a)}catch(e){console.log(e)}}return t&&null!=n.title?React.createElement("div",{className:this._replyClasses(e)},React.createElement("div",{className:"reply-card-inner"},React.createElement("img",{alt:e.display_name,className:"reply-card-thumbnail",height:"150",width:"150",src:n.thumbnail}),React.createElement("div",{className:"reply-card-details"},React.createElement("div",{className:"reply-card-text",dangerouslySetInnerHTML:{__html:n.title}})))):React.createElement("div",{className:this._replyClasses(e)},React.createElement("div",{className:"reply-avatar"},React.createElement("img",{alt:e.display_name,className:"avatar avatar-150 photo",height:"150",width:"150",src:e.avatar_url}),React.createElement("span",{className:"display_name"},e.display_name)),React.createElement("div",{className:"reply-content"},React.createElement("span",{className:"reply-time",dangerouslySetInnerHTML:{__html:e.time}}),null!=e.reply?React.createElement("div",{className:"reply-text",dangerouslySetInnerHTML:{__html:e.reply.replace(/\n/g,"<br />")}}):null))}}]),t}();n.default=c},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r.default.chats,t=arguments[1];switch(t.type){case c.GET_CONTACTS_SUCCESS:var n={contacts:t.chat.contacts,replies:t.chat.replies,active:t.chat.active,touid:t.chat.touid,fuid:t.chat.fuid};return 0==e.firstLoaded&&(n.firstLoaded=!0),Object.assign({},e,n);case c.GET_REPLIES_SUCCESS:if(0!=t.lastRID)return 0==t.replies.length?Object.assign({},e,{noReplyNum:e.noReplyNum+1}):Object.assign({},e,{noReplyNum:0,replies:[].concat(i(e.replies),i(t.replies))});var a={replies:t.replies,noReplyNum:0};return t.replies.length?(a.firstRemain=!0,a.firstRID=t.replies[0].crid,a.lastRID=t.replies[t.replies.length-1].crid):(a.firstRemain=!1,a.firstRID=0,a.lastRID=0),Object.assign({},e,a);case c.GET_MORE_TOP_REPLIES_SUCCESS:var o={replies:[].concat(i(t.replies),i(e.replies))};return t.replies.length||(o.firstRemain=!1),Object.assign({},e,o);case c.CHANGE_CONTACT_SUCCESS:return Object.assign({},e,{active:t.contact.cid,touid:t.contact.touid,fuid:t.contact.user_one});case c.REPLY_SUCCESS:return Object.assign({},e,{replies:[].concat(i(e.replies),[t.reply])});case c.UPDATE_FIRST_LAST_RID_SUCCESS:return Object.assign({},e,{firstRID:t.firstRID,lastRID:t.lastRID});case c.RESET_CHATS_STATE_SUCCESS:return r.default.chats;case"NEW_CONTACT":return[].concat(i(e),[t.contact]);default:return e}};var a,o=e("./initialState"),r=(a=o)&&a.__esModule?a:{default:a},c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../actions/actionTypes"));function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}},{"../actions/actionTypes":3,"./initialState":9}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./ChatReducer"),r=(a=o)&&a.__esModule?a:{default:a};var c=Redux.combineReducers;n.default=c({chats:r.default})},{"./ChatReducer":7}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={chats:{contacts:[],replies:[],firstLoaded:!1,active:0,touid:0,fuid:0,firstRemain:!0,firstRID:0,lastRID:0,noReplyNum:0}}},{}]},{},[1]);