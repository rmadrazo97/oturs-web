{"version":3,"sources":["../../../../jses/payments.js"],"names":["$","document","on","e","preventDefault","data","FormData","$form","$btn","find","addClass","append","ajax","type","url","_townhub_add_ons","dataType","cache","contentType","processData","success","res","removeClass","window","location","href","length","hide","show","result","before","remove","error","err","console","log","btn_text","method","val","$lcheckout_btn","children","text","handler","StripeCheckout","configure","key","_townhub_add_ons_payments","publishable_key","image","logo","locale","currency","currency_code","token","id","email","submit","hasClass","extend","amount","plan","is_recurring","JSON","parse","decodeURIComponent","open","name","site_title","description","recurring_text","replace","one_time_text","use_email","addEventListener","close","jQuery"],"mappings":"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","file":"payments.min.js","sourcesContent":["(function($) {\n\t\"use strict\";\n\n\t$(document).on('submit','#townhub-checkout-form',function(e){\n        e.preventDefault();\n        var data = new FormData(this),\n            $form = $(this),\n            $btn = $(this).find('.lcheckout_btn');\n            $btn.addClass('loading');\n\n        data.append('action', 'checkout_form')\n\n        $.ajax({\n            type : \"POST\",\n            url: _townhub_add_ons.url,\n            dataType : \"json\",\n            data: data,\n            cache: false,\n            contentType: false,\n            processData: false,\n            success: function(res) {\n                // console.log(res)\n                if(res.success){\n                \t$btn.removeClass('loading');\n\t                if (res.url != null && res.url != ''){\n\t                    window.location.href = res.url;\n\t                }else{\n                        if($('#ck-tab-ck_confirm').length && $('#ck-fieldset-ck_confirm').length){\n                            $('.ck-tab-item').removeClass('active')\n                            $('#ck-tab-ck_confirm').addClass(\"active\");\n                            $('.ck-fieldset-item').hide()\n                            $('#ck-fieldset-ck_confirm').show().addClass('ck-fieldset-show')\n                        }else if(res.result != null && res.result != ''){\n                            $form.before(res.result);\n                            $form.remove();\n                        }\n                    }\n                }else{\n                \t// console.log(res)\n                }\n\t                \n            },\n            error : function(err){\n                console.log(err)\n            }\n        });\n    });\n\n\n\t// select payment method\n    $(document).on('change','input[type=\"radio\"][name=\"payment-method\"]',function(e){\n        e.preventDefault();\n        var btn_text = $(this).data('btn') || '',\n        \tmethod = $(this).val(),\n        \t$lcheckout_btn = $('#lcheckout_btn');\n        if(btn_text) $lcheckout_btn.children('.btn-text').text(btn_text)\n        // for Stripe payment\n        if(method === 'stripe') \n        \t$lcheckout_btn.addClass('stripe-checkout') \n        else \n        \t$lcheckout_btn.removeClass('stripe-checkout') \n    }) \n\n\n    // stripe \n    // https://stripe.com/docs/checkout#integration-custom\n    var handler = StripeCheckout.configure({\n\t  \tkey: _townhub_add_ons_payments.publishable_key,\n\t  \timage: _townhub_add_ons_payments.logo,\n\t  \t\n\t  \tlocale: 'auto',\n\n\t  \tcurrency: _townhub_add_ons_payments.currency_code,\n\n\t  \t// panelLabel: 'Pay {{amount}}', // 'Subscribe {{amount}}'\n\t  \ttoken: function(token) {\n\t    \t// You can access the token ID with `token.id`.\n\t    \t// Get the token ID to your server-side code for use.\n\n\t    \t// var stripeToken = token.id;\n    \t\t// var stripeEmail = token.email;\n\n    \t\tvar $form = $('#townhub-checkout-form');\n    \t\t$form.append(`<input type=\"hidden\" name=\"stripeToken\" value=\"${token.id}\">`)\n    \t\t$form.append(`<input type=\"hidden\" name=\"stripeEmail\" value=\"${token.email}\">`)\n\n    \t\t$form.submit()\n\t  \t}\n\t});\n\n\n    $(document).on('click','#lcheckout_btn',function(e){\n        if($(this).hasClass('stripe-checkout')){\n        \tvar data = $(this).data('payment')\n        \tif(data != null){\n        \t\tdata = $.extend({}, {amount: 5390, plan: \"Basic\", email: \"\", is_recurring: false}, JSON.parse(decodeURIComponent(data)) )\n        \t}\n        \t// Open Checkout with further options:\n\t\t\thandler.open({\n\t\t\t    name: _townhub_add_ons_payments.site_title,\n\t\t\t    // description: _townhub_add_ons_payments.site_desc,\n\t\t\t    description: data.is_recurring? _townhub_add_ons_payments.recurring_text.replace('{{plan}}', data.plan) : _townhub_add_ons_payments.one_time_text.replace('{{plan}}', data.plan),\n\t\t\t    // zipCode: true,\n\t\t\t    amount: data.amount,\n\n\t\t\t    email: _townhub_add_ons_payments.use_email ? data.email : '',// data.email\n\t\t\t});\n\t\t\te.preventDefault();\n        }\n        \n        \n    })\n\n\t// Close Checkout on page navigation:\n\twindow.addEventListener('popstate', function() {\n\t  \thandler.close();\n\t});\n\n\n})(jQuery);"]}